<launch>
  <arg name="launch_openni" default="true" />
  <arg name="launch_imagesift" default="true" />
  <arg name="launch_facedetection" default="true" />

  <!-- launch jsk-defined pr2_2dnav that respawn for change inflation_radius
       <include file="$(find pr2_2dnav)/pr2_2dnav.launch" /> -->
  <include file="$(find jsk_pr2_startup)/jsk_pr2_move_base/pr2_2dnav.launch" />

  <node name="dynamic_tf_publisher" pkg="dynamic_tf_publisher"
        type="tf_publish.py" />
  <include file="$(find jsk_maps)/launch/start_map_eng2.launch" />

  <!-- japanese speech node -->
  <node pkg="sound_play" type="soundplay_node.py" name="sound_node_jp">
    <env name="PATH" value="$(find voice_text):$(env PATH)" />
    <remap from="robotsound" to="robotsound_jp" />
  </node>

  <!-- start sift on narrow left-->
  <group ns="/narrow_stereo/left" if="$(arg launch_imagesift)" >
    <node machine="c1" name="throttle" pkg="topic_tools"
          type="throttle" args="messages image_rect 2.0"/>
    <node machine="c2" name="sift" pkg="imagesift" type="imagesift"
          args="image:=image_rect_throttle"
          launch-prefix="nice -n +10"/>
  </group>

  <!-- kinect node -->
  <include file="$(find jsk_pr2_startup)/jsk_pr2_sensors/kinect_head.launch" >
    <arg name="launch_openni" value="$(arg launch_openni)" />
  </include>

  <!-- face detection node -->
  <node pkg="face_detector" type="face_detector" name="face_detector"
        args="stereo:=narrow_stereo image:=image_rect" machine="c2"
        if="$(arg launch_facedetection)" >
         <param name="classifier_name" type="string" value="frontalface" />
         <param name="classifier_filename" type="string" value="$(find opencv2)/opencv/share/opencv/haarcascades/haarcascade_frontalface_alt.xml"/>
         <param name="classifier_reliability" type="double" value="0.9"/>
         <param name="do_continuous" type="bool" value="true" />
         <param name="do_publish_faces_of_unknown_size" type="bool" value="false" />
         <param name="do_display" type="string" value="none" />
         <param name="output" type="string" value="none" />
  </node>

  <!-- logging node for PR2 -->
  <include file="$(find jsk_pr2_startup)/jsk_pr2_lifelog/db_client.launch"/>

  <!-- pr2 warning -->
  <!-- battery warning -->
  <node name="battery_warning" pkg="roseus"
        type="roseus" args="$(find jsk_pr2_startup)/jsk_pr2_warning/battery_warning.l"/>
  <node name="cable_warning" pkg="roseus"
        type="roseus" args="$(find jsk_pr2_startup)/jsk_pr2_warning/cable_warning.l"/>

  <!-- mjpeg_server for web -->
  <node pkg="mjpeg_server" type="mjpeg_server"  name="mjpeg_server" output="screen">
    <param name="port" type="int" value="8080" />
  </node>

  <include file="$(find jsk_pr2_startup)/jsk_pr2_sensors/tilt_scan_cloud.launch" />

  <!-- for gripper sensor actions -->
  <include file="$(find pr2_gripper_sensor_action)/launch/pr2_gripper_sensor_actions.launch" />

  <!-- for iPad or android apps -->
  <node name="tablet_receiver_default" pkg="jsk_smart_gui" respawn="true"
        type="tablet_receiver.l" output="screen" args="(execute-main)" >
    <param name="~ray_srv" value="/pointcloud_screenpoint_nodelet/screen_to_point"/>
  </node>

  <include file="$(find jsk_pcl_ros)/launch/pointcloud_screenpoint.launch" />

  <node pkg="image_view2" name="image_view2_for_tablet"
        type="image_view2" output="screen" respawn="true">
    <remap from="image" to="/camera/rgb/image_rect_color"/>
    <remap from="camera_info" to="/camera/rgb/camera_info"/>
    <remap from="image_marked" to="/camera/marked/image_raw"/>
    <param name="blurry" value="true"/>
    <param name="use_window" value="false"/>
  </node>

  <node pkg="topic_tools" type="mux"
        respawn="true" name="marked_camera_info"
        args="/camera/marked/camera_info /camera/rgb/camera_info"/>
  <node ns="/camera/marked" pkg="image_proc" type="image_proc"
        respawn="true" name="marked_image_proc" />
  <node name="kinect_marked_image_throttle" pkg="topic_tools" type="throttle"
        args="messages /camera/marked/image_rect_color/compressed 5.0" />

</launch>
